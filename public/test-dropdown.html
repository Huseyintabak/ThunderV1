<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dropdown Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h2>Dropdown Test</h2>
        
        <div class="row">
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="product-type" class="form-label">√úr√ºn Tipi *</label>
                    <select class="form-select" id="product-type" required onchange="loadProductsByType()">
                        <option value="">√úr√ºn tipi se√ßiniz</option>
                        <option value="yarimamul">Yarƒ± Mamul</option>
                        <option value="nihai">Nihai √úr√ºn</option>
                    </select>
                </div>
            </div>
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="selected-product" class="form-label">√úr√ºn Se√ßimi *</label>
                    <select class="form-select" id="selected-product" required disabled>
                        <option value="">√ñnce √ºr√ºn tipi se√ßiniz</option>
                    </select>
                </div>
            </div>
        </div>
        
        <div class="mt-3">
            <button class="btn btn-primary" onclick="testFunction()">Test Fonksiyonu</button>
        </div>
    </div>

    <script>
        // Plan modal'ƒ±nda √ºr√ºn tipine g√∂re √ºr√ºnleri y√ºkle
        window.loadProductsByType = async function() {
            console.log('üîç HTML i√ßindeki loadProductsByType √ßaƒürƒ±ldƒ±');
            
            const productTypeElement = document.getElementById('product-type');
            const productSelectElement = document.getElementById('selected-product');
            
            console.log('üîç product-type element:', productTypeElement);
            console.log('üîç selected-product element:', productSelectElement);
            
            if (!productTypeElement) {
                console.error('‚ùå product-type element bulunamadƒ±!');
                return;
            }
            
            if (!productSelectElement) {
                console.error('‚ùå selected-product element bulunamadƒ±!');
                return;
            }
            
            const productType = productTypeElement.value;
            const productSelect = productSelectElement;
            
            console.log('üîç Se√ßilen √ºr√ºn tipi:', productType);
            
            if (!productType) {
                productSelect.innerHTML = '<option value="">√ñnce √ºr√ºn tipi se√ßiniz</option>';
                productSelect.disabled = true;
                return;
            }
            
            productSelect.innerHTML = '<option value="">Y√ºkleniyor...</option>';
            productSelect.disabled = true;
            
            try {
                let apiEndpoint = '';
                switch(productType) {
                    case 'yarimamul':
                        apiEndpoint = '/api/yarimamuller';
                        break;
                    case 'nihai':
                        apiEndpoint = '/api/nihai_urunler';
                        break;
                    default:
                        throw new Error('Ge√ßersiz √ºr√ºn tipi');
                }
                
                console.log('üîç API endpoint:', apiEndpoint);
                const response = await fetch(apiEndpoint);
                console.log('üì° API response:', response.status);
                
                if (!response.ok) {
                    throw new Error(`API hatasƒ±: ${response.status}`);
                }
                
                const products = await response.json();
                console.log(`üîç ${productType} API'den gelen veriler:`, products);
                
                productSelect.innerHTML = '<option value="">√úr√ºn se√ßiniz...</option>';
                
                if (!Array.isArray(products) || products.length === 0) {
                    console.warn(`‚ö†Ô∏è ${productType} i√ßin √ºr√ºn bulunamadƒ±`);
                    productSelect.innerHTML = '<option value="">√úr√ºn bulunamadƒ±</option>';
                    productSelect.disabled = true;
                    return;
                }
                
                console.log(`üîç ${products.length} √ºr√ºn bulundu, se√ßenekler ekleniyor...`);
                products.forEach((product, index) => {
                    console.log(`üîç √úr√ºn ${index + 1}:`, product);
                    const option = document.createElement('option');
                    option.value = product.id;
                    // Veri yapƒ±sƒ±na g√∂re doƒüru alanlarƒ± kullan
                    const productName = product.ad || product.name || product.urun_adi || 'Bilinmeyen √úr√ºn';
                    const productCode = product.kod || product.code || 'Kod yok';
                    option.textContent = `${productName} (${productCode})`;
                    productSelect.appendChild(option);
                });
                
                productSelect.disabled = false;
                console.log(`‚úÖ ${products.length} √ºr√ºn se√ßeneƒüi y√ºklendi`);
                
            } catch (error) {
                console.error(`‚ùå ${productType} √ºr√ºnleri y√ºklenirken hata:`, error);
                productSelect.innerHTML = '<option value="">Hata: √úr√ºnler y√ºklenemedi</option>';
                productSelect.disabled = true;
            }
        }
        
        function testFunction() {
            console.log('üîç Test fonksiyonu √ßaƒürƒ±ldƒ±');
            loadProductsByType();
        }
        
        // Sayfa y√ºklendiƒüinde test et
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üîç Sayfa y√ºklendi, test ba≈ülatƒ±lƒ±yor...');
            
            // 2 saniye sonra otomatik test
            setTimeout(() => {
                console.log('üîç Otomatik test ba≈ülatƒ±lƒ±yor...');
                document.getElementById('product-type').value = 'nihai';
                loadProductsByType();
            }, 2000);
        });
    </script>
</body>
</html>
